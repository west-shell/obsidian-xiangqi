> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.weweweb.net](https://www.weweweb.net/wiki/index.php/XQF)

> 象棋演播室 (XQStudio) 1.0 版 XQF 文件格式說明

象棋演播室 (XQStudio) 1.0 版 XQF 文件格式說明

(XQF 1.0)

(過河象, xqstudio@qipaile.net)

2001 年 4 月 16 日

一、說明
----

本文件格式是 XQStudio 1.0 所使用的文件格式，現公佈該格式的主要目的是為了方便程序員將棋譜數據保存為 XQF 文件格式，以便藉助於 XQStudio 的打譜功能。各下棋網站或對弈軟件均可將棋譜保存為此格式，這樣 XQStudio 的任意版本均可以使用該文件。

由於 XQStudio 1.0 的後續版本使用了更為複雜的文件格式，使用該格式不保證能讀出 XQStudio 更高版本的 XQF 文件。換句話說，該格式只保證可以產生一個正確的 XQF 文件，不保證所有的 XQF 文件都是該格式。

二、XQF 文件使用的棋盤坐標
---------------

在 XQF 文件中，用數字坐標表示棋盤上交叉點的位置，其中 X 坐標從 0 到 8,Y 坐標從 0 到 9，坐標的原點 (0,0) 在棋盤的左下角。如下圖，黑方的將在位置 (4,9) 處，紅方的帥在位置 (4,0) 處。

[![](https://www.weweweb.net/wiki/images/0/00/XQF_coordinates.png)](https://www.weweweb.net/wiki/index.php/File:XQF_coordinates.png)

在 XQF 文件中，一個棋盤位置用一個字節表示，字節值 = X * 10 + Y。因此上圖中的黑帥可用字節值 49(十進制) 表示，也就是十六進制的 0x31；紅方的帥可用字節值 40 表示，也就是十六進制的 0x28。所有被吃掉的子，用位置 255, 即十六進制的 0xFF 表示。

三、XQF 文件中初始局面的表示
----------------

在 XQF 文件中，使用連續的 32 個字節表示棋盤的初始局面。這 32 個字節的位置順序是固定的，含義如下:

01 - 16: 依次為紅方的車馬相士帥士相馬車炮砲兵兵兵兵兵

17 - 32: 依次為黑方的車馬象士將士像馬車炮炮卒卒卒卒卒

用這 32 個字節的含義加上前面所說的字節值和棋盤位置的對應關係，可以用連續 32 個字節的值表示一個當前的局面。例如，全局的初始局面可以用如下的 32 個字節表

示 (注：所有的值為十進制，紅方和黑方均從右到左排列):

(80,70,60,50,40,30,20,10,00,72,12,83,63,43,23,03,09,19,29,39,49,59,69,79,89,17,77,06,26,46,66,86)

四、XQF 1.0 文件格式說明
----------------

下面的部分是 XQF 1.0 的文件格式說明，請嚴格按該格式生成 XQF 文件。下面說明中文件的偏移量用 16 進製表示。 XQF 文件由文件頭和棋譜記錄兩部分組成，分別說明如下：

### A. 文件頭部 (0000 - 03FF)

0000 - 0001 XQF 文件標記，必須為'XQ' (0000 = 'X', 0001 = 'Q')

0002 XQF 文件版本號，必須為 0x0A = (XQF 1.0)。

0003 - 000F 保留：必須全部為 0x00

0010 - 002F 這 32 個字節是棋局的開局局面，局面說明見 “局面表示”

0030 - 0032 保留：必須全部為 0x00

0033 棋局的結果: 0x00 - 未知, 0x01 - 紅勝, 0x02 - 黑勝, 0x03 - 和棋

0034 - 003F 保留：必須全部為 0x00

0040 棋局的類型: 0x00 - 全局文件, 0x01 - 佈局文件, 0x02 - 中局文件, 0x03 - 殘局文件

0041 - 004F 保留：必須全部為 0x00

0050 標題的長度 (即下面文字的長度，下同)

0051 - 008F 標題文字

* * *

從 0050-008F 實際是一個字符串的保存方法，先在第一個 字節保存字符串的長度，接著存字符串的內容，不足的部 分用 0x00 填充（下同）。

0090 - 00CF 保留：必須全部為 0x00

00D0 比賽名稱的長度

00D1 - 010F 比賽名稱

0110 比賽日期的長度

0111 - 011F 比賽日期

0120 比賽地點的長度

0121 - 012F 比賽地點

0130 紅方棋手名字的長度

0131 - 013F 紅方棋手名字

0140 黑方棋手名字的長度

0141 - 014F 黑方棋手名字

0150 用時規則的長度

0151 - 018F 用時規則

0190 紅方用時的長度

0191 - 019F 紅方用時

01A0 黑方用時的長度

01A1 - 01AF 黑方用時

01B0 - 01CF 保留: 必須全部為 0x00

01D0 棋譜講評人名字的長度

01D1 - 01DF 棋譜講評人名字

01E0 文件作者名字的長度

01E1 - 01EF 文件作者名字

01F0 - 03FF 保留: 全部為 0x00

### B. 棋譜記錄 (0400 - 文件尾部)

從 0x0400 開始存放棋譜記錄，每步記錄的存放格式為: 8 個棋譜記錄字節 + 0 個或多個字節的棋譜註解文本。其中，8 個棋譜記錄字節的格式為:

第 1 字節: 本步棋的開始位置坐標的字節值 (X*10+Y) + 24 (十進制)。

第 2 字節: 本步棋的到達位置坐標的字節值 (X*10+Y) + 32 (十進制)。

第 3 字節: 如果不是最後一步棋，為 0xF0；如果是最後一步棋，為 0x00。

第 4 字節: 保留: 必須為 0x00。

第 5-8 字節: 為一個 32 位整數 (x86 格式, 高字節在後)，表明本步註解的大小，如果沒有註解，則為 0x00000000。

如果本步沒有評註，即 5-8 字節全部為 0x00，則本步結束，否則，隨後存放本步評註文本，文本不以'\0'結束 (由於前面已經有大小, 該文本的長度必須等於 5-8 字節處的整數值)。如此反复，可將所有棋步存入。 (暫時不支持變著的保存)。從上面可以看出如果沒有註解，一步棋的記錄共佔 8 個字節。

需要說明的是，在真正的對局記錄開始前，必須有一步空的著法，稱為第 0 步，該步的第 1 - 8 字節必須是 0x18, 0x20, 0xF0, 0xFF, 0x00, 0x00, 0x00, 0x00。由於這些字節是固定的，所以真正的棋譜記錄是從 0x0408 處開始的。如果您的棋局只有初始局面而沒有任何著法記錄 (即只有一個殘局局勢), 則文件中棋譜記錄只有第 0 步的記錄，並且該記錄的 8 個字節為: 0x18,0x20,0x00,0xFF,0x00,0x00,0x00,0x00。詳細的格式請參見本文後面的文件例子。

四、給程序員
------

使用上面的格式，可以將全局或殘局的主變著存入 XQF 文件，也可以編寫 XQF 文件信息的處理程序，XQF 文件信息在各版本中是相同的，並且沒有任何加密措施。

  
該文件格式的最新版本可到作者的主頁 ([http://www.qipaile.net) 上下載, 如有不明白的地方，可以向作者詢問，歡迎大家將文件保存為 XQF 文件。](http://www.qipaile.xn--net),,,xqf-yi2pma1a931alhd24ooydsv6aqtax2sgql0wle7bc6t0lcr2cvz4jga69li1ep5l1w2bd91bre4bhhak844aok5dx5tbypg./)

過河象 (xqstudio@qipaile.net)

[http://www.qipaile.net](http://www.qipaile.net/)

2001 年 4 月 16 日

```
************************************************************************** 
* * 
*最新文件格式的版本請看“http://www.qipaile.net/xqstudio/XqfFormat.txt”* 
*以上URL請注意字母的大小寫。 * 
* * 
**************************************************************************
```

  
附: XQF 1.0 格式文件的例子 (為節省篇幅，只有 8 個回合的記錄)

A. 棋譜文件內容如下:

* * *

標題: 仙人指路對起馬局

賽事: "中立杯" 象棋電視快棋賽

日期: 1997 年 11 月 16 日

地點: 北京

紅方: 柳大華

黑方: 呂欽

結果: 黑方勝

評論: 劉殿中

作者: 過河象

* * *

```
1.兵七進一馬８進７ 2.兵三進一炮２平３ 

3.相七進五馬２進１ 4.馬八進七車１平２ 

5.車九平八車２進４ 6.炮八平九車２平８ 

7.炮二進五炮３平８ 8.馬二進三車９平８
```

* * *

棋譜由 XQStudio 生成 ([http://www.qipaile.net/xqstudio](http://www.qipaile.net/xqstudio))

  
B. 對應上面棋局的 XQF 文件內容如下:

* * *

請參照前面的說明進行分析。

0000: 58 51 0A 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

'XQ' . - 這三個字節是重要的文件標記，不可改變。

0010: 50 46 3C 32 28 1E 14 0A-00 48 0C 53 3F 2B 17 03

0020: 09 13 1D 27 31 3B 45 4F-59 11 4D 06 1A 2E 42 56

* * *

以上 32 個字節為棋局的初始局面的位置，如過您要生成的文件是全局文件，可直接使用上面的數據。

0030: 00 00 00 02 00 00 00 00-00 00 00 00 00 00 00 00

* * *

棋局的結果，0x02 = 黑勝

0040: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

棋局文件的類型: 0x00 = 全局文件

0050: 10 CF C9 C8 CB D6 B8 C2-B7 B6 D4 C6 F0 C2 ED BE

0060: D6 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

0070: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

0080: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

以上 64 個字節為文件標題，第一個字節為長度 (0x10), “仙人指路對起馬局” 共 16 個字節，所以長度為 0x10。

下面所有的字符串規律相同。

0090: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

00A0: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

00B0: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

00C0: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

以上 64 個字節為保留字節，必須為 0x00。

00D0: 16 22 D6 D0 C1 A2 B1 AD-22 CF F3 C6 E5 B5 E7 CA

00E0: D3 BF EC C6 E5 C8 FC 00-00 00 00 00 00 00 00 00

00F0: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

0100: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

以上 64 個字節為比賽名稱 “"中立杯" 象棋電視快棋賽”

0110: 0E 31 39 39 37 C4 EA 31-31 D4 C2 31 36 C8 D5 00

* * *

以上 16 個字節為比賽日期 “1997 年 11 月 16 日”

0120: 04 B1 B1 BE A9 00 00 00-00 00 00 00 00 00 00 00

* * *

以上 16 個字節為比賽地點 “北京”

0130: 06 C1 F8 B4 F3 BB AA 00-00 00 00 00 00 00 00 00

* * *

以上 16 個字節為紅方棋手 “柳大華”

0140: 06 C2 C0 20 20 C7 D5 00-00 00 00 00 00 00 00 00

* * *

以上 16 個字節為黑方棋手 “呂欽”

0150: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

0160: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

0170: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

0180: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

以上 64 個字節為用時規則，空，沒有輸入

0190: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

以上 16 個字節為紅方用時，空，沒有輸入

01A0: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

以上 16 個字節為紅方用時，空，沒有輸入

01B0: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

01C0: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

以上 64 個字節為保留字節，必須為 0x00

01D0: 06 C1 F5 B5 EE D6 D0 00-00 00 00 00 00 00 00 00

* * *

以上 16 個字節為棋譜講評 “劉殿中”

01E0: 06 B9 FD BA D3 CF F3 00-00 00 00 00 00 00 00 00

* * *

以上 16 個字節為文件作者 “過河象”

01F0: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

... 為節省篇幅，省去許多 0x00 ...

03F0: 00 00 00 00 00 00 00 00-00 00 00 00 00 00 00 00

* * *

以上從 0x1F0-0x3F0 的所有字節為保留字節，為 0x00

  
從下面 (0x400) 出開始為棋譜記錄

0400: 18 20 F0 FF 00 00 00 00-2F 38 F0 00 00 00 00 00

* * *

第 0 步，內容固定 (8 字節) 第 1 步: 兵七進一

* * *

第 1 步 “兵七進一” 內容分析如下:

* * *

兵七進一的起點坐標 (2, 3), 落點坐標 (2, 4), 則

1. 起點字節值 =(X*10+Y)+24 = 23+24 = 47 (0x2F)

2. 落點字節值 =(X*10+Y)+32 = 24+32 = 56 (0x38)

3. 本步不是最後一步，所以第 3 個字節為 (0xF0)

4. 第 4 個字節是保留字節，必須為 0x00 (0x00)

5. 本步沒有註解，所以 5-8 字節為 0x00. (0x00)

6. (0x00)

7. (0x00)

8. (0x00)

如果棋譜記錄中沒有任何著法，則只有第 0 步的棋譜記錄，並且第 0 步棋譜記錄的第三個字節為 0x00, 文件內容到 0x0407 處就結束了。

0410: 67 63 F0 00 00 00 00 00-57 60 F0 00 00 00 00 00

* * *

馬８進７兵三進一

0420: 29 3B F0 00 00 00 00 00-2C 4A F0 00 00 00 00 00

* * *

炮２平３相七進五

0430: 2B 27 F0 00 00 00 00 00-22 36 F0 00 00 00 00 00

* * *

馬２進１馬八進七

  
0440: 21 33 F0 00 00 00 00 00-18 2A F0 00 00 00 00 00

* * *

車１平２車九平八

0450: 2B 2F F0 00 00 00 00 00-24 22 F0 00 00 00 00 00

* * *

車２進４炮八平九

0460: 27 6B F0 00 00 00 00 00-60 6D F0 00 00 00 00 00

* * *

車２平８炮二進五

0470: 33 6D F0 00 00 00 00 00-5E 5E F0 00 00 00 00 00

* * *

炮３平８馬二進三

0480: 71 6F 00 00 00 00 00 00

* * *

車９平８ (注意第 3 個字節，最後一步, 應為 0x00)

  
注：

1. 如果將上面的全部數據存到一個文件中，即形成一個標準的 XQF 文件，該文件的大小為 0x0488(十進制 1160) 個字節。

2. 為研究和測試 XQF 1.0 文件結構，可下載 XQStudio 1.0 的版本生成多個不同的文件進行比較和分析，下載地址: “[http://www.qipaile.net/xqstudio/XQStudio_1_0.zip”](http://www.qipaile.net/xqstudio/XQStudio_1_0.zip%E2%80%9D) (注意大小寫)

* * *

(☆☆☆歡迎訪問 “[http://www.qipaile.net”](http://www.qipaile.xn--net-9o0a/) ☆☆☆)